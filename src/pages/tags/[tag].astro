---
import BaseLayout from "../../layouts/BaseLayout.astro"
import PageListing from "../../components/PageListing.svelte"
export async function getStaticPaths({ }) {
  const allPosts = Astro.fetchContent('../../../content/articles/*.md')
  const allTags = new Set()
  allPosts.map(post => {
      post.taxonomies && post.taxonomies.tags.map(tag => allTags.add(tag.toLowerCase()))
  })

  return Array.from(allTags).map((tag) => {
    const filteredPosts = allPosts.filter((post) => post.taxonomies?.tags.includes(tag))
    return {
      params: { tag },
      props: {
          pages: filteredPosts
      }
    };
  });
}

const { pages } = Astro.props // pages prop passed in `getStaticPaths`
const { params } = Astro.request // `params` passed in `getStaticPaths`
---

<BaseLayout>
    <h2>{params.tag}</h2>
    <div class="article-info">
      <a href="/tags">ALL TAGS</a>
      {pages.map(page => (<PageListing {page} />))}
    </div>
</BaseLayout>